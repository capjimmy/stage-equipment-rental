[문서명] 기획 및 정책 확정 이력 로그
[목적] 모든 개발 방향성 및 정책 결정 과정 추적
[시작일] 2025-12-28

========================================================
2025-12-28 - 초기 기획 검토 및 미비사항 도출
========================================================

[작업 내용]
1. 기존 기획서 검토
   - 파일: [프로젝트명] 공연무대용품 멀티벤더 렌탈 플랫폼.txt
   - 전반적으로 잘 작성된 기획이나 실제 구현을 위한 세부 정책 미비

2. 미비사항 13개 항목 도출

[도출된 미비사항]

🔴 필수 (MVP 전 반드시 해결)
1. User, Category 엔티티 추가
2. 가격 계산 로직 명확화 (일수 계산 방식)
3. 충돌 검증 규칙 구체화 (당일 반납/대여 가능 여부)
4. Asset 배정 로직 명확화
5. 최소한의 배송/수령 방식 정의
6. Payment 엔티티 및 환불 로직

🟡 중요 (MVP 출시 직후 필요)
7. 파손/연체/분실 최소 처리 로직
8. 알림 시스템
9. DB 인덱스 전략
10. API 응답 표준화

🟢 향후 개선 (2차 개발)
11. 리뷰/평점 시스템
12. 관리자 통계/리포트
13. 고급 검색 엔진
14. 추천 시스템

[결론]
기획의 뼈대는 훌륭하나, 실제 운영을 위한 세부 정책(결제, 배송, 취소, 정산)이
구체화되어야 개발 착수 가능

========================================================
2025-12-28 - 보완 답변서 v1 검토
========================================================

[작업 내용]
보완 답변서 v1 파일 검토
- 파일: [문서명] 미비사항 보완 답변서 v1.txt

[확정된 정책 - 1차]

1. 예약 충돌 검증 정책
   ✅ 확정: buffer_days = 1일 고정
   - 반납일과 다음 대여 시작일은 최소 1일 간격 필요
   - 블로킹 기간 = [start_date, end_date + 1]
   - 이유: 검수/세탁/준비 시간 확보

2. 결제 시스템
   ✅ 확정: 계좌이체 승인형 (2단계)
   - PG 연동은 2차로 미룸
   - 프로세스:
     1) 고객 예약 요청 (REQUESTED)
     2) 운영자 1차 승인 → HOLD_PENDINGPAY (임시 블로킹)
     3) 고객 입금
     4) 운영자 2차 승인 → CONFIRMED (확정)
   - 입금 기한: 기본 24시간 (또는 운영자 설정)
   - 만료 시 자동 EXPIRED 처리 (배치 작업)

3. 배송 정책
   ✅ 확정: 운영자 배송
   - 방식: quick(퀵) / parcel(택배) / bundle(묶음배송)
   - 묶음배송: 100,000원 고정 (업셀 유도)
   - 나머지: 운영자 견적

4. 계약/약관
   ✅ 확정: 파손/연체/뒷타임 영향 배상 조항 포함
   - 특히 "뒷타임 영향 배상" 조항 중요
   - RentalIssue 엔티티에 impact_next_booking 필드 필요

[여전히 미비한 부분]

⚠️ 즉시 결정 필요:
1. 입금 기한 설정: 자동 24시간 vs 운영자 수동 조정
2. Asset 배정 시점: 1차 승인 시 즉시 vs 2차 승인 시
3. HOLD_PENDINGPAY 상태에서 고객 취소 가능 여부
4. 배송 방식 선택 주체: 고객 vs 운영자
5. 파손 추가 청구 정산 분배율: 공급자 100% vs 50:50
6. 보증금 정책: MVP 수령 여부
7. 취소 위약금 정책: 단계별 환불율
8. 검수 불합격 시 상태 전환 방법

========================================================
2025-12-28 - 최종 정책 확정 (사용자 의사결정)
========================================================

[작업 내용]
사용자와의 대화를 통해 모든 미결정 사항 확정

[최종 확정 정책]

1. 입금 기한
   ✅ 확정: 24시간 고정 (자동 설정)
   - 운영자 수동 조정 기능 제외 (복잡도 감소)

2. Asset 배정 시점
   ✅ 확정: 1차 승인 시 즉시 배정
   - 이유: 블로킹 확실성 보장, 로직 단순화
   - 입금 기한이 24시간으로 짧아 asset 낭비 최소화

3. 고객 취소 가능 여부
   ✅ 확정: HOLD_PENDINGPAY 상태에서도 고객 취소 가능
   - 입금 전: 100% 환불
   - 입금 후: 취소 정책 적용 (아래 참조)

4. 배송 방식 선택 주체
   ✅ 확정: 고객이 예약 요청 시 선택
   - 선택지: quick / parcel / bundle
   - bundle은 100,000원 고정 표시

5. 파손 추가 청구 정산
   ✅ 확정: 공급자 100% 수령
   - 플랫폼 수수료 없음
   - 이유: 공급자 물품 관리 책임 + 위험 보상
   - Settlement.type = 'issue'일 때 platform_fee_amount = 0

6. 보증금 정책
   ✅ 확정: MVP에서 제외
   - 진입장벽 낮춤
   - 파손 발생 시 사후 청구로 처리
   - 2차에서 도입 검토

7. 취소 위약금 정책
   ✅ 확정: 단계별 차등 환불

   기준점:
   - "결제" = 고객 입금 완료 (2차 승인 시점)
   - "대여 시작일" = start_date

   환불율:
   | 취소 시점                 | 환불율 | 위약금 |
   |---------------------------|--------|--------|
   | 입금 후 2시간 이내         | 100%   | 0%     |
   | 대여 21일 이전             | 100%   | 0%     |
   | 대여 14~20일 전            | 50%    | 50%    |
   | 대여 7~13일 전             | 20%    | 80%    |
   | 대여 0~6일 전              | 10%    | 90%    |
   | 출고 시작(DISPATCHED) 후   | 취소 불가 | -   |

   우선순위:
   - "입금 후 2시간 쿨링오프"가 최우선
   - 예: 대여 5일 전 입금해도, 입금 후 2시간 내면 100% 환불

8. 검수 불합격 처리
   ✅ 확정: 상태 세분화

   Fulfillment Status 추가:
   - RETURNED: 고객 반납 완료 (검수 전)
   - INSPECTING: 검수 중
   - INSPECTION_PASSED: 검수 합격 → Settlement 생성
   - INSPECTION_FAILED: 검수 불합격 → RentalIssue 생성

[상태 전환 권한 매트릭스]

| 현재 상태           | 전환 가능 상태    | 권한     | UI/조건                    |
|---------------------|-------------------|----------|----------------------------|
| REQUESTED           | HOLD_PENDINGPAY   | Admin    | [1차 승인] 버튼            |
| REQUESTED           | REJECTED          | Admin    | [거절] 버튼 + 사유         |
| REQUESTED           | CANCELED          | Customer | [취소] 버튼 (100% 환불)    |
| HOLD_PENDINGPAY     | CONFIRMED         | Admin    | [2차 승인] 버튼            |
| HOLD_PENDINGPAY     | REJECTED          | Admin    | [거절] 버튼                |
| HOLD_PENDINGPAY     | CANCELED          | Customer | [취소] 버튼 (100% 환불)    |
| HOLD_PENDINGPAY     | EXPIRED           | System   | 배치(24시간 초과 시)       |
| CONFIRMED           | CANCELED          | Customer | [취소] 버튼 (환불 정책)    |
| PREPARING           | CANCELED          | Customer | [취소] 버튼 (환불 정책)    |
| DISPATCHED          | -                 | -        | 취소 불가                  |

[정산 정책 정리]

1. 기본 렌탈료 정산 (type='rental')
   - 생성 시점: INSPECTION_PASSED
   - 분배율: 50:50 (공급자 50%, 플랫폼 50%)

2. 파손/연체 추가 청구 정산 (type='issue')
   - 생성 시점: RentalIssue RESOLVED
   - 분배율: 공급자 100%, 플랫폼 0%

[결론]
✅ 모든 핵심 정책 확정 완료
✅ 개발 착수 가능 수준 도달

========================================================
2025-12-28 - 최종 통합 문서 작성
========================================================

[작업 내용]
1. 확정된 모든 정책을 통합한 최종 명세서 작성
   - 파일: [최종확정] 운영정책 및 개발명세 통합본.txt

2. 개발 로그 문서 작성 (현재 문서)
   - 파일: [개발로그] 기획 및 정책 확정 이력.txt

[최종 문서 구성]

1. 서비스 정체성
2. 핵심 UX 원칙
3. 사용자 역할 및 권한
4. 핵심 데이터 모델 (14개 엔티티)
5. 결제 시스템 (계좌이체 승인형)
6. 취소/환불 정책
7. 배송 정책
8. 계약/약관
9. 검색 요구사항
10. 기술 스택
11. DB 인덱스 전략
12. API 응답 형식
13. MVP 범위
14. 배치 작업
15. API 엔드포인트
16. 비기능 요구사항
17. 최종 체크리스트

[다음 단계]
✅ 개발 착수 준비 완료
→ 프로젝트 셋업 (Next.js + NestJS)
→ DB 스키마 설계 및 마이그레이션
→ 핵심 기능 개발 시작

========================================================
[향후 업데이트 양식]
========================================================

날짜: YYYY-MM-DD
작업: [작업 제목]

[변경 사항]
- 변경 내용 1
- 변경 내용 2

[사유]
- 변경 이유

[영향 범위]
- 영향받는 기능/엔티티

[결정 사항]
- 최종 결정 내용

========================================================
